\ProvidesPackage{preamble}

% Корректность отображения всех шрифтов, кодировок и мат. символов
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{amssymb, amsmath, amsthm, mathtools}

% Настройки шрифта
\usepackage{fontspec}
\setmainfont{CMU Serif}
\setsansfont{CMU Sans Serif}
\setmonofont{CMU Typewriter Text}

% Отображение содержания
\usepackage{tocloft}
\addto\captionsrussian{\renewcommand*{\contentsname}{Программа экзамена}}
\renewcommand{\cftsecfont}{\mdseries}
\renewcommand{\cftsecpagefont}{\mdseries}

% Заголовки секций
\usepackage{titlesec}
\titleformat{\section}[hang]{\large\centering\scshape}{\thesection.\:}{0pt}{}
\titleformat{\subsection}[hang]{\scshape}{\thesubsection.\:}{0pt}{}

% Дата и время
\usepackage[yyyymmdd, hhmmss]{datetime}

% Отступ у первого абзаца
\usepackage{indentfirst}

% Вставка картинок
\usepackage{graphicx}
\graphicspath{img/}

% Asymptote для иллюстраций
\usepackage{asymptote}

% Огибание картинок текстом
\usepackage{wrapfig}

% Для зачёркиваний
\usepackage{cancel}

% Римские числа из арабских
\newcommand{\rnum}[1]{\uppercase\expandafter{\romannumeral #1\relax}}

% Гиперссылки
\usepackage{hyperref}
\hypersetup{
    frenchlinks=true,
}

\urlstyle{same}

% Цвета
\usepackage{xcolor}

% Часто используемые обозначения
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\K}{\mathbb{K}}
\renewcommand{\C}{\mathbb{C}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\B}{\mathcal{B}}
\renewcommand{\f}{\mathcal{F}}
\newcommand{\Ten}{\mathbb{T}}
\newcommand{\T}{\mathcal{T}}
\renewcommand{\P}{\mathcal{P}}
\renewcommand{\U}{\mathcal{U}}
\renewcommand{\O}{\mathcal{O}}
\renewcommand{\S}{\mathcal{S}}
\newcommand{\D}{\mathcal{D}}
\newcommand{\ds}{\displaystyle}
\newcommand{\id}{\mathrm{id}}
\newcommand{\rk}{\operatorname{rk}}
\newcommand{\tr}{\operatorname{tr}}
\newcommand{\pr}{\operatorname{pr}}
\newcommand{\ort}{\operatorname{ort}}
\newcommand{\pf}{\operatorname{pf}}
\newcommand{\Vol}{\operatorname{Vol}}
\newcommand{\sgn}{\operatorname{sgn}}
\newcommand{\dist}{\operatorname{dist}}
\newcommand{\diam}{\operatorname{diam}}
\newcommand{\codim}{\operatorname{codim}}
\newcommand{\aff}{\operatorname{aff}}
\renewcommand{\Re}{\operatorname{Re}}
\renewcommand{\Im}{\operatorname{Im}}
\newcommand{\Ker}{\operatorname{Ker}}
\newcommand{\Hom}{\operatorname{Hom}}
\newcommand{\End}{\operatorname{End}}
\newcommand{\Mat}{\operatorname{Mat}}
\newcommand{\ord}{\operatorname{ord}}
\newcommand{\Sym}{\operatorname{Sym}}
\newcommand{\Alt}{\operatorname{Alt}}
\renewcommand{\gcd}{\operatorname{НОД}}
\newcommand{\lcm}{\operatorname{НОК}}
\newcommand{\bs}[1]{\boldsymbol{#1}}
\newcommand{\abs}[1]{\left\lvert#1\right\rvert}
\newcommand{\br}[1]{\left(#1\right)}
\newcommand{\sqbr}[1]{\left[#1\right]}
\newcommand{\ddfrac}[2]{\frac{\ds #1}{\ds #2}}
\DeclareMathOperator*{\lowint}{\underline{\int}}
\DeclareMathOperator*{\upint}{\overline{\int}}
\newcommand\bigzero{\scalebox{2}{$0$}}

% Отступы между абзацами
\setlength{\parskip}{.5ex}

% Отступы
\usepackage[left=18mm, right=18mm, top=20mm, bottom=14mm, includefoot]{geometry}

% Для работы со списками
\usepackage{enumitem}

% Оболочка для теоремы
\newcounter{theorem}[section]
\newenvironment{theorem}[1][]{\par\smallskip
\refstepcounter{theorem}
    \ifx&#1&
        \smallskip\noindent{\bfseries Теорема \thetheorem.}
    \else
        \smallskip\noindent{\bfseries Теорема \thetheorem\;{\mdseries(#1)}.}
    \fi
    }{
    \par\smallskip
}

% Оболочка для доказательства
\renewenvironment{proof}{\smallskip
    \noindent{\bfseries Доказательство.}
}{
    \hfill$\blacksquare$\par\smallskip
}

% Оболочка для решения
\newenvironment{solution}{\smallskip
    \noindent$\vartriangleright$
}{
    \hfill$\blacktriangleleft$\par\smallskip
}

% Оболочки для леммы, предложения и утверждения
\newcounter{lemma}[section]
\newenvironment{lemma}[1][]{\par\smallskip
\refstepcounter{lemma}
    \ifx&#1&
        \smallskip\noindent{\bfseries Лемма \thelemma.}
    \else
        \smallskip\noindent{\bfseries Лемма \thelemma\;{\mdseries(#1)}.}
    \fi
    }{
    \par\smallskip
}

\newcounter{proposal}[section]
\newenvironment{proposal}[1][]{\par\smallskip
\refstepcounter{proposal}
    \ifx&#1&
        \smallskip\noindent{\bfseries Предложение \theproposal.}
    \else
        \smallskip\noindent{\bfseries Предложение \theproposal\;{\mdseries(#1)}.}
    \fi
    }{
    \par\smallskip
}

\newcounter{statement}[section]
\newenvironment{statement}[1][]{\par\smallskip
\refstepcounter{statement}
    \ifx&#1&
        \smallskip\noindent{\bfseries Утверждение \thestatement.}
    \else
        \smallskip\noindent{\bfseries Утверждение \thestatement\;{\mdseries(#1)}.}
    \fi
    }{
    \par\smallskip
}

% Оболочка для определения
\newcounter{definition}[section]
\newenvironment{definition}[1][]{\par\smallskip
\refstepcounter{definition}
    \ifx&#1&
        \smallskip\noindent{\bfseries Определение \thedefinition.}
    \else
        \smallskip\noindent{\bfseries Определение \thedefinition\;{\mdseries(#1)}.}
    \fi
    }{
    \par\smallskip
}

% Оболочка для примечания
\newenvironment{remark}[1][]{\par\smallskip
    \ifx&#1&
        \smallskip\noindent{\bfseries Примечание.}
    \else
        \smallskip\noindent{\bfseries Примечание\;(#1).}
    \fi
    }{
    \par\smallskip
}

% Оболочка для следствия
\newcounter{corollary}[theorem]
\newenvironment{corollary}[1][]{\par\smallskip
\refstepcounter{corollary}
    \ifx&#1&
        \smallskip\noindent{\bfseries Следствие \thecorollary.}
    \else
        \smallskip\noindent{\bfseries Следствие \thecorollary\;{\mdseries(#1)}.}
    \fi
    }{
\par\smallskip
}

% Оболочка для упражнения
\newcounter{exercise}[section]
\newenvironment{exercise}[1][]{\par\smallskip
\refstepcounter{exercise}
    \ifx&#1&
        \smallskip\noindent{\bfseries Упражнение \theexercise.}
    \else
        \smallskip\noindent{\bfseries Упражнение \theexercise\;{\mdseries(#1)}.}
    \fi
    }{
    \par\smallskip
}

% Оболочка для примера
\newcounter{example}[section]
\newenvironment{example}[1][]{\par\smallskip
\refstepcounter{example}
    \ifx&#1&
        \smallskip\noindent{\bfseries Пример \theexample.}
    \else
        \smallskip\noindent{\bfseries Пример \theexample\;{\mdseries(#1)}.}
    \fi
    }{
    \par\smallskip
}

% Оболочка для упражнения
\newcounter{problem}
\newenvironment{problem}[1][]{\par\smallskip
\refstepcounter{problem}
    \ifx&#1&
        \smallskip\noindent{\bfseries Задача \theproblem.}
    \else
        \smallskip\noindent{\bfseries Задача \theproblem\;{\mdseries(#1)}.}
    \fi
    }{
    \par\smallskip
}

% https://tex.stackexchange.com/questions/251904/hyperlinks-from-chapter-and-section-headings-back-to-the-table-of-contents
\makeatletter
\let\hyperchapter\chapter
\def\chapter{\@ifstar\starchapter\mychapter}
\def\starchapter{\hyperchapter*}
\newcommand{\mychapter}[2][\@empty]% #1=optional (toc and top of page), #2=title
{\ifx#1\@empty \hyperchapter[#2]{\hyperlink{toc.chapter.\thechapter}{#2}}
 \else \hyperchapter[#1]{\hyperlink{toc.chapter.\thechapter}{#2}}
 \fi}

\let\hypersection\section
\def\section{\@ifstar\starsection\mysection}
\def\starsection{\hypersection*}
\newcommand{\mysection}[2][\@empty]% #1=optional (toc), #2=title
{\ifx#1\@empty \hypersection[#2]{\hyperlink{toc.section.\thesection}{#2}}
 \else \hypersecton[#1]{\hyperlink{toc.section.\thesection}{#2}}
 \fi}
\makeatother

